# PHP局部变量 全局变量 静态变量的归纳分析【原创】

 时间 2017-02-19 16:03:27  

原文[http://blog.it985.com/19717.html][1]

之前遇到过一个问题 需要定义一个大数组用来检测字符串是否多拼， 当时发现直接将大数组定义在函数运行速度非常慢 然而将变量在外部定义为静态 或使用全局变量时则速度明细提升 在探索原因前先归纳一下不同变量的定义

局部变量：在函数内部中定义的变量，它的作用域为函数定义范围内。

静态变量： 静态变量属于静态存储方式，其存储空间为内存中的静态数据区（在静态存储区内分配存储单元），该区域中的数据在整个程序的运行期间一直占用这些存储空间（在程序整个运行期间都不释放），也可以认为是其内存地址不变，直到整个程序运行结束（相反，而 auto自动变量，即动态局部变量，属于动态存储类别，占动态存储空间，函数调用结束后即释放）。静态变量虽在程序的整个执行过程中始终存在，但是在它作 用域之外不能使用。

全局变量：在函数外部定义的变量，它的作用域从定义处一直到文件结尾，在函数中使用global调用 否则会由局部变量覆盖。全局变量虽属于静态存储方式，但不一定是静态变量，必须由 static加以定义后才能成为静态外部变量，或称静态全局变量。

当用户在PHP中调用一个函数或者类的方法时，内核会创建一个新的符号表并激活之，这也就是为什么我们无法在函数中使用在函数外定义的变量的原因（因为它们分属两个符号表，一个当前作用域的，一个全局作用域的）。在循环调用一个函数时，php会不停的创建函数里的局部变量，哪怕变量的值一样，而使用静态变量或全局变量时，因为变量在程序运行时一直存在所以不需要多次创建。

在之前的多拼函数中 随机生成5000个字符串测试

```php
<?php
function microtimeFloat()
{
    list($usec, $sec) = explode(" ", microtime());
    return ((float) $usec + (float) $sec);
}

//随机生成字符串用于测试
$random_array = array();
for ($i = 0; $i < 5000; $i++) {
    $str = array_merge(range(0, 9), range('a', 'z'));
    shuffle($str);
    $random_array[] = implode('', array_slice($str, 0, array_rand(range(2, 15))));
}

$time_start = microtimeFloat();

foreach ($random_array as $row) {
    //测试函数
}

$time_end = microtimeFloat();
$time     = $time_end - $time_start;

echo $time;

```

结果 全局变量和静态变量一直在1.8s左右 而使用定义在函数体内的局部变量则需花费15倍左右的时间

本文永久地址：http://blog.it985.com/19717.html

本文出自IT985博客 ，转载时请注明出处及相应链接。


[1]: http://blog.it985.com/19717.html
