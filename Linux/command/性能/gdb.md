## gdb常用命令


在调试程序的时候，gdb是一柄利器，恰当的使用gdb可以解决掉程序的许多bug。
gdb并不检查语法错误，那是gcc或者g++的事情，gdb干的是调试的事情。
说明：   
（1） gdb 程序名 [corefile] 之类的是代表命令的用法，[]中间的内容是可选项，即你可以加，也可以不加。  
（2）如果需要重复执行一条命令，不需要每次都键入命令，gdb记住了最后一个被执行的命令，只要简单的按enter键就可以重复执行最后的命令。   
## 1. gdb命令 

该命令主要用来启动调试。

**_gdb 程序名 [corefile]_**

corefile是可选的，但能增强gdb的调试能力。[Linux][4]默认是不生成corefile的，所以需要在.bashrc文件中添加

    ulimit -c unlimited

修改完.bashrc文件后记得. .bashrc让修改生效。
![][5]

![][6]

下面是一个没有语法错误，但是存在逻辑错误的代码：

![][7]

一运行立马就会提示错误：

    Segmentation fault (coredumped)

我们列出当前目录下的文件，发现多了一个core.*之类的文件，这就是系统给我们生成的core文件。

我们现在可以启动gdb进行调试了。

    gdb 1 core.1997

其中1是代码生成的程序，core.1997是出错后系统给我们生成的core文件。

如果你不喜欢一大堆的软件信息，可以通过-q参数关闭软件信息

    gdb -q 1 core.1997

    #0 0x080483c4 in test () at test.c:5

    5 *p = 2;

可以看到gdb通过core告诉你，程序哪条语句出现问题

## 2. run命令 

![][8]

该命令使得程序跑起来，需要注意：gdb命令并没有运行程序，只是进入了gdb状态。

## 3. continue命令 

与run相对的是continue命令，记住，run是开始执行，continue是继续执行，两者是不同的，程序在断点处听下之后，你如果输入run，程序会重新启动，而输入continue，程序会从断点处向下继续执行。

## 4. where命令 

where命令，可以显示导致段错误的执行函数处。

![][11]


    #0 0x080483c4 in test () at test.c:5

    #1 0x080483e6 in main () at test.c:10

## 5. list命令 

知道函数出错行的上下文对调试程序是很有帮助的。

_**list[m,n]**_ ，m,n是要显示包含错误首次出现位置的起始行和结尾行。不带参数的list将显示附近的10行代码。

![][13]

![][14]

## 6. break命令 

break命令主要用来设置断点。具体用法如下：

    _**break linenum**_在文件的linenum行设置断点；
    
    _**break funcname**_ 对funcname函数设置断点，每次该函数被调用都会触发断点；
    
    _**break filename:linenum**_在filename文件的linenum行设置断点；
    
    **_break filename:funcname_**在filename文件对funcname函数设置断点。

![][17]
对于上面的一段代码，我们对test函数设置断点，在第10行设置断点：

![][18]
    
    info break可以查看已有的断点的信息。

    delete + 断点序号可以删除断点。

## 7. 单步调试命令 

step命令：step顾名思义，就是一步一步执行。当遇到一个函数的时候，step将进入函数，每次执行一条语句，相当于step into。

next命令：当遇到一个函数的时候，next将执行整个函数，相当于step over。

## 8. print命令 

gdb最有用的功能之一就是它可以显示被调试程序中任何表达式、变量的值。

    **_print 变量，表达式_**
    **_print ‘file’::变量，表达式_** , ‘’是必须的，以便让gdb知道指的是一个文件名。
    **_print funcname::变量，表达式_**


我们先对test函数设置断点，然后单步执行，然后输出i的值：

![][22]

我们可以看到，print命令确实强大，方便地输出了变量的值。

## 9. whatis命令 

whatis 命令可以告诉你变量的类型，ptype 告诉你结构的定义。

![][24]

## 10. return命令 


_return [value]_

 停止执行当前函数，将value返回给调用者，相当于stepreturn。

 执行该命令，会让当前的函数立马退出，并且返回。

![][26]

## 11. set命令 

该命令可以改变一个变量的值。

_set variable varname = value_

varname是变量名称，value是变量的新值。

![][28]


当然gdb还有非常多复杂的命令，不过它们用到的机率非常低，熟练地掌握了上面的命令，一般应付大部分的调试都不存在问题。

[4]: http://lib.csdn.net/base/linux
[5]: ./img/20150612231809899.png
[6]: ./img/20150612231826433.png
[7]: ./img/20150612233557551.png
[8]: ./img/20150612232115278.png
[11]: ./img/20150612232212102.png
[13]: ./img/20150612232335481.png
[14]: ./img/20150612232349882.png
[17]: ./img/20150612232536359.png
[18]: ./img/20150612232615362.png
[22]: ./img/20150612232805596.png
[24]: ./img/20150612233225596.png
[26]: ./img/20150612232953828.png
[28]: ./img/20150612233116583.png