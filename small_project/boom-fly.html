<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta author='gongbangwei'>
    <title>大炮</title>
</head>
<body>
    <div id='lidu'>
        <span>选择大炮的</span>
        <input type="radio" checked='checked' value='25'>大
        <input type="radio"  value='20'>中
        <input type="radio"  value='15'>小
    </div>

    <canvas id='can' width="640" height="480" style=" border:2px solid">no support html5</canvas>
    <script src='vector2d.js'></script><!-- js 库  -->
    <script src='jquery-1.8.3.min.js'></script>
    <script>
    var gameObj=[],
    canvas=document.getElementById('can'),
    ctx=canvas.getContext('2d');

    var cannonBall = function (x,y,vector){
        var gravity=0,
        that={
            x: x,
            y: y,
            removeMe:false,
            move: function (){
                vector.vy += gravity;
                gravity += 0.1;
                //模拟加速度
                that.x+=vector.vx;
                that.y+=vector.vy;
                if(that.y > canvas.height -150){
                    that.removeMe=true;
                }
            },
            draw: function (){
                ctx.beginPath();
                ctx.arc(that.x,that.y,8,0,Math.PI * 2);
                ctx.fill();
                ctx.closePath();
                }
             };

        return that;
    }
    var cannon= function (x,y,lidu){
        var mx=0,
        my=0,
        angle=0,
        that={
            x: x,
            y: y,
            lidu:lidu,
            angle:0,
            removeMe:false,
            move:function (){
                angle=Math.atan2(my-that.y,mx-that.x);
            },
            draw:function(){
                ctx.save();
                ctx.lineWidth=2;
                ctx.translate(that.x,that.y);
                //平移，将画布的坐标原点向左右方向移动x，向上下方向移动y.canvas的默认位置是在（0,0）
                ctx.rotate(angle);
                //画布旋转
                ctx.strokeRect(0,-5,50,10);
                ctx.moveTo(0,0);
                ctx.beginPath();
                ctx.arc(0,0,15,0,Math.PI * 2 );
                ctx.fill();
                ctx.closePath();
                ctx.restore();
            }
        };//end that
        canvas.onmousedown = function(){
            //在这里调用向量的那个js
            var vec = vector2d(mx-that.x,my-that.y);
            vec.normalize();
            //console.log(lidu);
            vec.scale(lidu);
            gameObj.push(cannonBall(that.x,that.y,vec));
        }
        canvas.onmousemove = function (event){
            var bb= canvas.getBoundingClientRect();
            mx=(event.clientX - bb.left);
            my=(event.clientY - bb.top);
        };
        return that;
    };
    //画蓝田和草地
    var drawSkyAndGrass = function (){
        ctx.save();
        ctx.globalAlpha= 0.4;
        var linGrad=ctx.createLinearGradient(0,0,0,canvas.height);
        linGrad.addColorStop(0,'#00BFFF');
        linGrad.addColorStop(0.5,'white');
        linGrad.addColorStop(0.5,'#55dd00');
        linGrad.addColorStop(1,'white');
        ctx.fillStyle=linGrad;
        ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.restore();

    }

    ///////main/////////////
    var lidu=$('#lidu').find("input:checked").val();
    gameObj.push(cannon(50,canvas.height-150,lidu));
    $('#lidu').click(function (event){
        var cl=event.target;
        $(this).find('input').each(function(){
            $(this).attr('checked',false)
        });
        $(cl).attr('checked',true);
        lidu=$(cl).val();
        gameObj.splice(0,gameObj.length);
        gameObj.push(cannon(50,canvas.height-150,lidu));
    })

    setInterval( function (){
        drawSkyAndGrass();
        var gameObj_fresh=[];
        for (var i = 0; i < gameObj.length; i++) {
            gameObj[i].move();
            gameObj[i].draw();
            if(gameObj[i].removeMe === false){
                gameObj_fresh.push(gameObj[i]);
            }
        }
        gameObj=gameObj_fresh;
    },50);
    </script>
</body>
</html>

<!-- 作者：michaelgbw
链接：http://www.jianshu.com/p/0275332a894b
來源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。 -->